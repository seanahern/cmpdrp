(function(e,t,n,r){"use strict";var i=1,s=2,o=i,u=!0,a=!1,f=0,l=0,c=null,h=0,p=[],d=null,v=null,m=null,g=null,y=null,b=null,w=null,E=null,S=null,x=function(e){e.stopPropagation();e.preventDefault();e.dataTransfer.dropEffect="copy"},T=function(e){e.stopPropagation();e.preventDefault();var t=e.dataTransfer.files,n=t.length,r=null,i=[];while(n--){r=t[n];if(r.type.toLowerCase().indexOf("image/")<0)continue;i.push(r)}i.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0});if(i.length===0)return;p=p.concat(i);N(p.length);h=l;C()},N=function(e){y.find(".hd .count").text("("+e+")")},C=function(){var t=l,n=p[t],r,i=new FileReader;l++;r='<li><a href="#" data-index="'+t+'">'+n.name+"</a></li>";E.find(".filenames").append(r);i.onload=function(n){return function(r){var i=e('<div class="view" data-index="'+t+'"></div>'),o=e("<img />");v.append(i);o.on("load",function(r){var i=this.width,s=this.height;k(this,n.name,t,i,s);e(this).css({"margin-left":"-"+Math.round(i/2)+"px"})});i.append(o);o.attr("src",r.target.result);if(u){u=!1;G(s)}t===h&&D(t);l<p.length&&C()}}(n);i.readAsDataURL(n)},k=function(t,n,r,i,s){var o=e('<canvas width="100" height="100" class="thumb" title="'+n+'" data-index="'+r+'"></canvas>'),u,a,f,l;if(i>s){u=100;a=s/i*u;f=0;l=(100-a)/2}else{a=100;u=i/s*a;f=(100-u)/2;l=0}var c=o.get(0).getContext("2d");c.drawImage(t,f,l,u,a);S.append(o)},L=function(){e(n.body).on("click",function(e){M()})},A=function(){e(n.body).off("click")},O=function(){v.find(".view").each(function(t,n){e(n).is(":visible")&&(f=t)});return f},M=function(){var e=O()+1;e>v.children().length-1&&(e=0);D(e)},_=function(){var e=O()-1;e<0&&(e=v.children().length-1);D(e)},D=function(n){v.children().hide();v.children().eq(n).show();E.find("ul").children().removeClass("selected");E.find("ul").children().eq(n).addClass("selected");S.children().removeClass("selected");S.children().eq(n).addClass("selected");e(t).scrollTop(0)},P=function(){y.hasClass("is-open")?I():B()},H=function(){b.hasClass("is-open")?I():j()},B=function(){F(y)},j=function(){F(b)},F=function(t){I();$();c=t;c.addClass("is-open");if(o===s){e(n.body).css("overflow","hidden");A();Z()}},I=function(){if(c!==null){J();c.removeClass("is-open");c=null;if(o===s){e(n.body).css("overflow","auto");L();Y()}}},q=function(){u=!0;f=0;l=0;p=[];G(i)},R=function(){E.show();S.hide()},U=function(){E.hide();S.show()},z=function(){g.show()},W=function(){g.hide()},X=function(){v.show()},V=function(){v.hide()},$=function(){w.show()},J=function(){w.hide()},K=function(){e(".btn-index").show();e(".btn-next").show();e(".btn-prev").show()},Q=function(){e(".btn-index").hide();e(".btn-next").hide();e(".btn-prev").hide()},G=function(e){if(e===o)return;o=e;switch(o){case i:J();V();I();z();Q();st();A();Z();N(0);E.find(".filenames").empty();S.empty();v.empty();break;case s:W();I();X();K();st();L();Y()}},Y=function(){e(n.body).on("mousemove",tt);e(n.body).on("mousedown",tt);e(n.body).on("mouseleave",et);nt()},Z=function(){e(n.body).off("mousemove",tt);e(n.body).off("mousedown",tt);e(n.body).off("mouseleave",et);rt()},et=function(){it()},tt=function(){if(!m.is(":visible")){m.stop();st()}nt()},nt=function(){rt();d=setTimeout(it,3e3)},rt=function(){if(d!==null){clearTimeout(d);d=null}},it=function(){rt();m.fadeOut(500)},st=function(){m.show()};e(n).ready(function(){g=e(".drop-zone");m=e(".nav");v=e(".views");y=e(".index");b=e(".help");w=e(".blocker");E=y.find(".list");S=y.find(".thumbs");Q();m.find(".btn-help").on("click",function(e){e.preventDefault();e.stopPropagation();j()});w.on("mousedown",function(e){I()});if(!(t.File&&t.FileReader&&t.FileList)){m.addClass("fallback");g.find(".msg").text("Sorry, your browser does not support local file access");g.find(".sub").html('Try <a href="http://www.google.com/chrome">Google Chrome</a> or <a href="http://www.mozilla.org/firefox">Firefox</a>');return}n.body.addEventListener("dragover",x,!1);n.body.addEventListener("drop",T,!1);y.on("click","a, canvas",function(t){t.preventDefault();t.stopPropagation();D(e(this).data("index"));I()});m.find(".btn-next").on("click",function(e){e.preventDefault();e.stopPropagation();M()});m.find(".btn-prev").on("click",function(e){e.preventDefault();e.stopPropagation();_()});m.find(".btn-index").on("click",function(e){e.preventDefault();e.stopPropagation();B()});y.find(".btn-list").on("click",function(e){e.preventDefault();e.stopPropagation();R()});y.find(".btn-thumbs").on("click",function(e){e.preventDefault();e.stopPropagation();U()});e(n).on("keydown",function(e){var t=v.children().length;if(e.shiftKey&&e.which===191){H();return}if(e.which===13){y.hasClass("is-open")&&I();return}if(e.which===27){if(c){e.preventDefault();e.stopPropagation();I()}return}if(t<1)return;if(e.which===73){P();return}if(e.which===82){q();return}if(e.which===84){y.hasClass("is-open")&&(S.is(":visible")?R():U());return}if(t<2)return;if(e.which===74){_();return}if(e.which===75){M();return}})})})(jQuery,window,document);