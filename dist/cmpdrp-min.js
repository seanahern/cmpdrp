!function(n,e,i,o){"use strict";var t=1,a=2,c=t,l=!0,r=0,f=0,s=null,d=0,u=[],h=null,p=null,v=null,w=null,m=null,g=null,b=null,y=null,x=null,k=null,C=function(n){n.stopPropagation(),n.preventDefault(),n.dataTransfer.dropEffect="copy"},D=function(n){n.stopPropagation(),n.preventDefault();for(var e=n.dataTransfer.files,i=e.length,o=null,t=[];i--;)o=e[i],o.type.toLowerCase().indexOf("image/")<0||t.push(o);t.sort(function(n,e){return n.name<e.name?-1:n.name>e.name?1:0}),0!==t.length&&(u=u.concat(t),P(u.length),d=f,F())},P=function(n){g.find(".hd .count").text("("+n+")")},F=function(){var e,i=f,o=u[i],t=new FileReader;f++,e='<li><a href="#" data-index="'+i+'">'+o.name+"</a></li>",x.find(".filenames").append(e),t.onload=function(e){return function(o){var t=n('<div class="view" data-index="'+i+'"></div>'),c=n("<img />");p.append(t),c.on("load",function(o){var t=this.width,a=this.height;L(this,e.name,i,t,a),n(this).css({"margin-left":"-"+Math.round(t/2)+"px"})}),t.append(c),c.attr("src",o.target.result),l&&(l=!1,Z(a)),i===d&&A(i),f<u.length&&F()}}(o),t.readAsDataURL(o)},L=function(e,i,o,t,a){var c,l,r,f,s=n('<canvas width="100" height="100" class="thumb" title="'+i+'" data-index="'+o+'"></canvas>');t>a?(c=100,l=a/t*c,r=0,f=(100-l)/2):(l=100,c=t/a*l,r=(100-c)/2,f=0);var d=s.get(0).getContext("2d");d.drawImage(e,r,f,c,l),k.append(s)},T=function(){n(i.body).on("click",function(n){E()})},R=function(){n(i.body).off("click")},q=function(){return p.find(".view").each(function(e,i){n(i).is(":visible")&&(r=e)}),r},E=function(){var n=q()+1;n>p.children().length-1&&(n=0),A(n)},z=function(){var n=q()-1;0>n&&(n=p.children().length-1),A(n)},A=function(i){p.children().hide(),p.children().eq(i).show(),x.find("ul").children().removeClass("selected"),x.find("ul").children().eq(i).addClass("selected"),k.children().removeClass("selected"),k.children().eq(i).addClass("selected"),n(e).scrollTop(0)},O=function(){g.hasClass("is-open")?K():j()},U=function(){b.hasClass("is-open")?K():G()},j=function(){I(g)},G=function(){I(b)},I=function(e){K(),V(),s=e,s.addClass("is-open"),c===a&&(n(i.body).css("overflow","hidden"),R(),_())},K=function(){null!==s&&(W(),s.removeClass("is-open"),s=null,c===a&&(n(i.body).css("overflow","auto"),T(),$()))},M=function(){l=!0,r=0,f=0,u=[],Z(t)},Q=function(){x.show(),k.hide()},S=function(){x.hide(),k.show()},B=function(){w.show()},H=function(){w.hide()},J=function(){p.show()},N=function(){p.hide()},V=function(){y.show()},W=function(){y.hide()},X=function(){n(".btn-index").show(),n(".btn-next").show(),n(".btn-prev").show()},Y=function(){n(".btn-index").hide(),n(".btn-next").hide(),n(".btn-prev").hide()},Z=function(n){if(n!==c)switch(c=n){case t:W(),N(),K(),B(),Y(),cn(),R(),_(),P(0),x.find(".filenames").empty(),k.empty(),p.empty();break;case a:H(),K(),J(),X(),cn(),T(),$()}},$=function(){n(i.body).on("mousemove",en),n(i.body).on("mousedown",en),n(i.body).on("mouseleave",nn),on()},_=function(){n(i.body).off("mousemove",en),n(i.body).off("mousedown",en),n(i.body).off("mouseleave",nn),tn()},nn=function(){an()},en=function(){v.is(":visible")||(v.stop(),cn()),on()},on=function(){tn(),h=setTimeout(an,3e3)},tn=function(){null!==h&&(clearTimeout(h),h=null)},an=function(){tn(),v.fadeOut(500)},cn=function(){v.show()};n(i).ready(function(){return w=n(".drop-zone"),m=n("#filepicker"),v=n(".nav"),p=n(".views"),g=n(".index"),b=n(".help"),y=n(".blocker"),x=g.find(".list"),k=g.find(".thumbs"),Y(),v.find(".btn-help").on("click",function(n){n.preventDefault(),n.stopPropagation(),G()}),y.on("mousedown",function(n){K()}),e.File&&e.FileReader&&e.FileList?(i.body.addEventListener("dragover",C,!1),i.body.addEventListener("drop",D,!1),g.on("click","a, canvas",function(e){e.preventDefault(),e.stopPropagation(),A(n(this).data("index")),K()}),v.find(".btn-next").on("click",function(n){n.preventDefault(),n.stopPropagation(),E()}),v.find(".btn-prev").on("click",function(n){n.preventDefault(),n.stopPropagation(),z()}),v.find(".btn-index").on("click",function(n){n.preventDefault(),n.stopPropagation(),j()}),g.find(".btn-list").on("click",function(n){n.preventDefault(),n.stopPropagation(),Q()}),g.find(".btn-thumbs").on("click",function(n){n.preventDefault(),n.stopPropagation(),S()}),w.click(function(e){e.preventDefault(),e.stopPropagation(),n("#filepicker").trigger("click")}),m.on("change",function(){for(var n,e=-1;n=this.files[++e];){var i=new FileReader;i.onload=function(n){return function(n){D(n)}}(n),i.readAsDataURL(n)}}),void n(i).on("keydown",function(n){var e=p.children().length;if(n.shiftKey&&191===n.which)return void U();if(13===n.which)return void(g.hasClass("is-open")&&K());if(27===n.which)return void(s&&(n.preventDefault(),n.stopPropagation(),K()));if(!(1>e)){if(73===n.which)return void O();if(82===n.which)return void M();if(84===n.which)return void(g.hasClass("is-open")&&(k.is(":visible")?Q():S()));if(!(2>e))return 74===n.which||37===n.which?void z():75===n.which||39===n.which?void E():void 0}})):(v.addClass("fallback"),w.find(".msg").text("Sorry, your browser does not support local file access"),void w.find(".sub").html('Try <a href="http://www.google.com/chrome">Google Chrome</a> or <a href="http://www.mozilla.org/firefox">Firefox</a>'))})}(jQuery,window,document);